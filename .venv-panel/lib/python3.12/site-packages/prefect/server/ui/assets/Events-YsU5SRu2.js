import{d as de,i as ee,ae as fe,ak as me,al as te,am as pe,an as ge,ao as ve,ap as be,aq as ye,ar as _e,as as xe,at as De,w as ne,j as L,c as U,a as H,n,o as O,k as T,m as z,q as ke,l as _,au as Te,a6 as R,av as Re,aw as je,ax as Se,ay as Ee,B as ae,F as Ie,az as Oe,z as he,aA as Be,aB as Ne}from"./index-D_EwbhA4.js";import{c as P,g as Ve}from"./_commonjsHelpers-Cpj98o6Y.js";import{u as Ce}from"./usePageTitle-C4lZ_oqi.js";import{m as se}from"./mapper-CZW8ZNVa.js";var X,re;function Fe(){if(re)return X;re=1;var Z="Expected a function",h=NaN,B="[object Symbol]",q=/^\s+|\s+$/g,x=/^[-+]0x[0-9a-f]+$/i,D=/^0b[01]+$/i,p=/^0o[0-7]+$/i,i=parseInt,u=typeof P=="object"&&P&&P.Object===Object&&P,w=typeof self=="object"&&self&&self.Object===Object&&self,M=u||w||Function("return this")(),W=Object.prototype,N=W.toString,j=Math.max,S=Math.min,E=function(){return M.Date.now()};function V(e,a,c){var g,d,t,l,s,f,b=0,o=!1,m=!1,v=!0;if(typeof e!="function")throw new TypeError(Z);a=C(a)||0,k(c)&&(o=!!c.leading,m="maxWait"in c,t=m?j(C(c.maxWait)||0,a):t,v="trailing"in c?!!c.trailing:v);function G(r){var y=g,I=d;return g=d=void 0,b=r,l=e.apply(I,y),l}function le(r){return b=r,s=setTimeout(F,a),o?G(r):l}function ie(r){var y=r-f,I=r-b,Y=a-y;return m?S(Y,t-I):Y}function J(r){var y=r-f,I=r-b;return f===void 0||y>=a||y<0||m&&I>=t}function F(){var r=E();if(J(r))return K(r);s=setTimeout(F,ie(r))}function K(r){return s=void 0,v&&g?G(r):(g=d=void 0,l)}function ue(){s!==void 0&&clearTimeout(s),b=0,g=f=d=s=void 0}function ce(){return s===void 0?l:K(E())}function Q(){var r=E(),y=J(r);if(g=arguments,d=this,f=r,y){if(s===void 0)return le(f);if(m)return s=setTimeout(F,a),G(f)}return s===void 0&&(s=setTimeout(F,a)),l}return Q.cancel=ue,Q.flush=ce,Q}function k(e){var a=typeof e;return!!e&&(a=="object"||a=="function")}function $(e){return!!e&&typeof e=="object"}function A(e){return typeof e=="symbol"||$(e)&&N.call(e)==B}function C(e){if(typeof e=="number")return e;if(A(e))return h;if(k(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=k(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=e.replace(q,"");var c=D.test(e);return c||p.test(e)?i(e.slice(2),c?2:8):x.test(e)?h:+e}return X=V,X}var Le=Fe();const Ue=Ve(Le),ze={class:"events__content"},Pe={class:"events__filters"},qe={class:"events__controls"},oe=6e4,Ae=de({__name:"Events",setup(Z){const h=ee(()=>[{text:"Event Feed"}]),B=fe(),{now:q}=me({interval:oe});Ce("Event Feed");const x=te("resource",[]),D=te("events",[]),p=pe({type:"span",seconds:-86400}),{startDate:i,endDate:u}=ge(),{selectionStart:w,selectionEnd:M}=ve(),W={minRangeInSeconds:Ne-1,maxRangeInSeconds:Be-1},N=be(()=>{const{startDate:d,endDate:t}=se.map("DateRangeSelectValue",p.range,"DateRange"),[l,s]=ye(D.value,v=>v.endsWith("*")),f=l.map(v=>v.replace(".*",".")),o=["prefect.log.write"].filter(v=>!s.includes(v));return{occurred:{since:w.value??d,until:M.value??t},anyResource:{idPrefix:x.value},event:{prefix:f,name:s,excludeName:o}}}),{page:j,pages:S,loading:E,events:V,empty:k}=_e(N,{interval:oe}),{margin:$}=xe(),A=()=>({rootMargin:$.value}),{stuck:C}=De(B,A),e=ee(()=>({chart:{"events__chart--stuck":C.value}}));let a=!1;const c=Ue(()=>{if(!(!i.value||!u.value)){if(a){a=!1;return}p.range={type:"range",startDate:i.value,endDate:u.value}}},1e3);ne([i,u],()=>c());function g(){var l,s;if(!p.range)return;const{startDate:d,endDate:t}=se.map("DateRangeSelectValue",p.range,"DateRange");((l=i.value)==null?void 0:l.getTime())!==d.getTime()&&(a=!0,i.value=d),((s=u.value)==null?void 0:s.getTime())!==t.getTime()&&(a=!0,u.value=t)}return ne(()=>p.range,()=>g()),g(),(d,t)=>{const l=L("p-label"),s=L("p-empty-results"),f=L("p-pager"),b=L("p-layout-default");return n(i)&&n(u)?(O(),U(b,{key:0,class:"events"},{header:T(()=>[_(n(he),{crumbs:h.value},null,8,["crumbs"])]),default:T(()=>[z("div",ze,[z("div",Pe,[_(l,{label:"Resource"},{default:T(({id:o})=>[_(n(Te),{id:o,selected:n(x),"onUpdate:selected":t[0]||(t[0]=m=>R(x)?x.value=m:null),multiple:""},null,8,["id","selected"])]),_:1}),_(l,{label:"Events"},{default:T(({id:o})=>[_(n(Re),{id:o,selected:n(D),"onUpdate:selected":t[1]||(t[1]=m=>R(D)?D.value=m:null),multiple:""},null,8,["id","selected"])]),_:1})]),z("div",{ref_key:"chart",ref:B,class:je(["events__chart p-background",e.value.chart])},[_(n(Se),{"start-date":n(i),"onUpdate:startDate":t[2]||(t[2]=o=>R(i)?i.value=o:null),"end-date":n(u),"onUpdate:endDate":t[3]||(t[3]=o=>R(u)?u.value=o:null),filter:N.value,"zoom-options":W},null,8,["start-date","end-date","filter"]),z("div",qe,[_(n(Ee),{modelValue:n(p).range,"onUpdate:modelValue":t[4]||(t[4]=o=>n(p).range=o),max:n(q)},null,8,["modelValue","max"])])],2),n(E)&&n(k)?(O(),U(s,{key:0},{message:T(()=>t[7]||(t[7]=[ae(" Loading events ")])),_:1})):(O(),ke(Ie,{key:1},[n(k)?(O(),U(s,{key:0},{message:T(()=>t[8]||(t[8]=[ae(" No events ")])),_:1})):H("",!0),_(n(Oe),{class:"events__timeline",events:n(V),"start-date":n(i),"end-date":n(u)},null,8,["events","start-date","end-date"]),n(V).length?(O(),U(f,{key:1,page:n(j),"onUpdate:page":t[5]||(t[5]=o=>R(j)?j.value=o:null),pages:n(S),"onUpdate:pages":t[6]||(t[6]=o=>R(S)?S.value=o:null),class:"events__pager"},null,8,["page","pages"])):H("",!0)],64))])]),_:1})):H("",!0)}}});export{Ae as default};
//# sourceMappingURL=Events-YsU5SRu2.js.map
